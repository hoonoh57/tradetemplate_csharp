Phase 1: DockPanel 전환 – 수정 파일 목록
App64/
├── packages.config              ← 신규
├── App64.csproj                 ← 수정 (NuGet 참조 + 새 파일 추가)
├── MainForm.cs                  ← 전면 교체
├── MainForm.Designer.cs         ← 전면 교체 (최소화)
├── MainForm.resx                ← 유지
├── Forms/                       ← 신규 폴더
│   ├── LogForm.cs
│   ├── WatchForm.cs
│   ├── ChartForm.cs
│   ├── SettingsForm.cs
│   └── PortfolioForm.cs
└── Services/                    ← 기존 유지 (변경 없음)
    ├── ConnectionService.cs
    ├── MarketDataService.cs
    ├── OrderService.cs
    └── CandleService.cs
1. packages.config (신규)
Copy<?xml version="1.0" encoding="utf-8"?>
<packages>
  <package id="DockPanelSuite" version="3.1.0" targetFramework="net481" />
  <package id="DockPanelSuite.ThemeVS2015" version="3.1.0" targetFramework="net481" />
</packages>
2. App64.csproj (전체 – 수정본)
Copy<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props"
          Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">x64</Platform>
    <ProjectGuid>{A1B2C3D4-0004-0000-0000-000000000000}</ProjectGuid>
    <OutputType>WinExe</OutputType>
    <RootNamespace>App64</RootNamespace>
    <AssemblyName>App64</AssemblyName>
    <TargetFrameworkVersion>v4.8.1</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <Deterministic>true</Deterministic>
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|x64' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|x64' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <PlatformTarget>x64</PlatformTarget>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.IO.Pipes" />
    <!-- DockPanelSuite -->
    <Reference Include="WeifenLuo.WinFormsUI.Docking">
      <HintPath>..\packages\DockPanelSuite.3.1.0\lib\net40\WeifenLuo.WinFormsUI.Docking.dll</HintPath>
    </Reference>
    <Reference Include="WeifenLuo.WinFormsUI.Docking.ThemeVS2015">
      <HintPath>..\packages\DockPanelSuite.ThemeVS2015.3.1.0\lib\net40\WeifenLuo.WinFormsUI.Docking.ThemeVS2015.dll</HintPath>
    </Reference>
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Properties\AssemblyInfo.cs" />
    <Compile Include="Program.cs" />
    <Compile Include="MainForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="MainForm.Designer.cs">
      <DependentUpon>MainForm.cs</DependentUpon>
    </Compile>
    <!-- Services (기존 유지) -->
    <Compile Include="Services\ConnectionService.cs" />
    <Compile Include="Services\MarketDataService.cs" />
    <Compile Include="Services\OrderService.cs" />
    <Compile Include="Services\CandleService.cs" />
    <!-- Forms (신규) -->
    <Compile Include="Forms\LogForm.cs" />
    <Compile Include="Forms\WatchForm.cs" />
    <Compile Include="Forms\ChartForm.cs" />
    <Compile Include="Forms\SettingsForm.cs" />
    <Compile Include="Forms\PortfolioForm.cs" />
    <!-- Resources -->
    <EmbeddedResource Include="MainForm.resx">
      <DependentUpon>MainForm.cs</DependentUpon>
    </EmbeddedResource>
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\Common\Common.csproj">
      <Project>{A1B2C3D4-0001-0000-0000-000000000000}</Project>
      <Name>Common</Name>
    </ProjectReference>
    <ProjectReference Include="..\Bridge\Bridge.csproj">
      <Project>{A1B2C3D4-0002-0000-0000-000000000000}</Project>
      <Name>Bridge</Name>
    </ProjectReference>
  </ItemGroup>
  <ItemGroup>
    <None Include="packages.config" />
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project>
Copy
3. MainForm.Designer.cs (전면 교체 – 최소화)
Copynamespace App64
{
    partial class MainForm
    {
        private System.ComponentModel.IContainer components = null;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
                components.Dispose();
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            this.SuspendLayout();
            // 
            // MainForm - 모든 UI는 SetupUI()에서 코드로 생성
            // 
            this.AutoScaleDimensions = new System.Drawing.SizeF(7F, 15F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.ClientSize = new System.Drawing.Size(1600, 900);
            this.Font = new System.Drawing.Font("맑은 고딕", 9F);
            this.Name = "MainForm";
            this.Text = "TradeTemplate";
            this.ResumeLayout(false);
        }
    }
}
4. MainForm.cs (전면 교체)
Copyusing System;
using System.Drawing;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using App64.Forms;
using App64.Services;
using Bridge;
using Common.Models;
using WeifenLuo.WinFormsUI.Docking;

namespace App64
{
    public partial class MainForm : Form
    {
        // ── 서비스 (기존 유지) ──────────────────────
        private ConnectionService _conn;
        private MarketDataService _market;
        private OrderService _order;
        private CandleService _candle;

        // ── DockPanel ───────────────────────────────
        private DockPanel _dockPanel;

        // ── 싱글톤 자식 폼 ──────────────────────────
        private LogForm _logForm;
        private SettingsForm _settingsForm;
        private WatchForm _watchForm;
        private PortfolioForm _portfolioForm;

        // ── 툴바/상태바 컨트롤 ──────────────────────
        private MenuStrip _menuStrip;
        private ToolStrip _toolStrip;
        private ToolStripButton _btnConnect;
        private ToolStripButton _btnOrderTest;
        private ToolStripLabel _lblStatus;
        private StatusStrip _statusStrip;
        private ToolStripStatusLabel _lblConnState;
        private ToolStripStatusLabel _lblKiwoomState;
        private ToolStripStatusLabel _lblCybosState;
        private ToolStripStatusLabel _lblMsgCount;
        private Timer _clockTimer;

        // ── 통계 ────────────────────────────────────
        private int _msgCount;

        public MainForm()
        {
            InitializeComponent();
            SetupUI();
        }

        // ═══════════════════════════════════════════
        //  UI 구성 (코드 기반 – Designer 의존 최소화)
        // ═══════════════════════════════════════════
        private void SetupUI()
        {
            this.Text = "TradeTemplate — App64";
            this.Size = new Size(1600, 900);
            this.StartPosition = FormStartPosition.CenterScreen;
            this.IsMdiContainer = true;
            this.BackColor = Color.FromArgb(20, 20, 30);

            // ── MenuStrip ──
            _menuStrip = new MenuStrip
            {
                BackColor = Color.FromArgb(30, 30, 40),
                ForeColor = Color.FromArgb(200, 200, 220)
            };

            var mnuFile = new ToolStripMenuItem("파일(&F)");
            mnuFile.DropDownItems.Add("종료(&X)", null, (s, e) => this.Close());

            var mnuView = new ToolStripMenuItem("보기(&V)");
            mnuView.DropDownItems.Add("종목감시(&W)", null, (s, e) => ShowOrActivate(ref _watchForm));
            mnuView.DropDownItems.Add("포트폴리오(&P)", null, (s, e) => ShowOrActivate(ref _portfolioForm));
            mnuView.DropDownItems.Add("로그(&L)", null, (s, e) => ShowOrActivate(ref _logForm));
            mnuView.DropDownItems.Add("설정(&S)", null, (s, e) => ShowOrActivate(ref _settingsForm));
            mnuView.DropDownItems.Add(new ToolStripSeparator());
            mnuView.DropDownItems.Add("레이아웃 초기화(&R)", null, (s, e) => ResetLayout());

            var mnuServer = new ToolStripMenuItem("서버(&S)");
            mnuServer.DropDownItems.Add("연결(&C)", null, async (s, e) => await ConnectAsync());
            mnuServer.DropDownItems.Add("연결해제(&D)", null, (s, e) => Disconnect());

            _menuStrip.Items.AddRange(new ToolStripItem[] { mnuFile, mnuView, mnuServer });
            this.MainMenuStrip = _menuStrip;
            this.Controls.Add(_menuStrip);

            // ── ToolStrip ──
            _toolStrip = new ToolStrip
            {
                BackColor = Color.FromArgb(30, 30, 40),
                ForeColor = Color.White,
                GripStyle = ToolStripGripStyle.Hidden,
                Renderer = new DarkToolStripRenderer()
            };

            _btnConnect = new ToolStripButton("연결")
            {
                DisplayStyle = ToolStripItemDisplayStyle.Text,
                ForeColor = Color.LimeGreen
            };
            _btnConnect.Click += async (s, e) => await ConnectAsync();

            _btnOrderTest = new ToolStripButton("주문 극한테스트")
            {
                DisplayStyle = ToolStripItemDisplayStyle.Text,
                ForeColor = Color.FromArgb(80, 180, 255),
                Enabled = false
            };
            _btnOrderTest.Click += BtnOrderTest_Click;

            _lblStatus = new ToolStripLabel("대기중")
            {
                ForeColor = Color.Gray,
                Alignment = ToolStripItemAlignment.Right
            };

            _toolStrip.Items.AddRange(new ToolStripItem[]
            {
                _btnConnect,
                new ToolStripSeparator(),
                _btnOrderTest,
                new ToolStripSeparator(),
                _lblStatus
            });
            this.Controls.Add(_toolStrip);

            // ── StatusStrip ──
            _statusStrip = new StatusStrip
            {
                BackColor = Color.FromArgb(25, 25, 35),
                SizingGrip = false
            };
            _lblConnState = new ToolStripStatusLabel("● 끊김")
            {
                ForeColor = Color.Red
            };
            _lblKiwoomState = new ToolStripStatusLabel("K:--")
            {
                ForeColor = Color.Gray
            };
            _lblCybosState = new ToolStripStatusLabel("C:--")
            {
                ForeColor = Color.Gray
            };
            _lblMsgCount = new ToolStripStatusLabel("Msg: 0")
            {
                ForeColor = Color.FromArgb(150, 150, 170),
                Spring = true,
                TextAlign = ContentAlignment.MiddleRight
            };
            _statusStrip.Items.AddRange(new ToolStripItem[]
            {
                _lblConnState, _lblKiwoomState, _lblCybosState, _lblMsgCount
            });
            this.Controls.Add(_statusStrip);

            // ── DockPanel (핵심) ──
            _dockPanel = new DockPanel
            {
                Dock = DockStyle.Fill,
                Theme = new VS2015DarkTheme(),
                DocumentStyle = DocumentStyle.DockingMdi,
                AllowEndUserDocking = true,
                AllowEndUserNestedDocking = true
            };
            this.Controls.Add(_dockPanel);
            _dockPanel.BringToFront(); // MenuStrip, ToolStrip, StatusStrip 뒤에

            // ── Clock Timer ──
            _clockTimer = new Timer { Interval = 1000 };
            _clockTimer.Tick += (s, e) =>
            {
                _lblMsgCount.Text = $"Msg: {_msgCount} | {DateTime.Now:HH:mm:ss}";
            };
            _clockTimer.Start();
        }

        // ═══════════════════════════════════════════
        //  Form Load – 레이아웃 초기화 + 자동 연결
        // ═══════════════════════════════════════════
        protected override async void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            ResetLayout();
            AppendLog("TradeTemplate App64 시작됨");
            await ConnectAsync();
        }

        // ═══════════════════════════════════════════
        //  레이아웃
        // ═══════════════════════════════════════════
        private void ResetLayout()
        {
            CloseAllForms();

            _logForm = new LogForm();
            _logForm.Show(_dockPanel, DockState.DockBottom);

            _watchForm = new WatchForm(this);
            _watchForm.Show(_dockPanel, DockState.DockLeft);

            _portfolioForm = new PortfolioForm();
            _portfolioForm.Show(_logForm.Pane, DockAlignment.Right, 0.5);

            _settingsForm = new SettingsForm();
            _settingsForm.Show(_dockPanel, DockState.DockRight);
        }

        private void CloseAllForms()
        {
            for (int i = _dockPanel.Contents.Count - 1; i >= 0; i--)
            {
                if (_dockPanel.Contents[i] is IDockContent content)
                    content.DockHandler.Close();
            }
            _logForm = null;
            _settingsForm = null;
            _watchForm = null;
            _portfolioForm = null;
        }

        // ═══════════════════════════════════════════
        //  연결
        // ═══════════════════════════════════════════
        private async Task ConnectAsync()
        {
            if (_conn != null && _conn.IsConnected)
            {
                AppendLog("이미 연결되어 있습니다");
                return;
            }

            _btnConnect.Enabled = false;
            _lblStatus.Text = "연결 중...";

            try
            {
                // 서비스 초기화
                _conn = new ConnectionService();
                _conn.OnLog += msg => AppendLog(msg);
                _conn.OnConnectionChanged += OnConnectionChanged;
                _conn.OnPushReceived += OnPushReceived;

                // MarketDataService – 실시간 시세 처리
                _market = new MarketDataService(_conn);
                _market.OnMarketDataUpdated += md =>
                {
                    this.BeginInvoke((Action)(() =>
                    {
                        _watchForm?.UpdateMarketData(md);
                    }));
                };

                _order = new OrderService(_conn);
                _candle = new CandleService(_conn);

                AppendLog("서버 연결 시도...");
                await _conn.ConnectAsync();

                // 로그인 상태 확인
                var loginStatus = await _conn.CheckLoginAsync();
                bool kiwoomOk = loginStatus.Item1;
                bool cybosOk = loginStatus.Item2;

                UpdateKiwoomIndicator(kiwoomOk);
                UpdateCybosIndicator(cybosOk);

                _btnOrderTest.Enabled = kiwoomOk;
                _lblStatus.Text = "연결 완료";
                _btnConnect.Text = "연결됨";

                AppendLog($"로그인 상태 — 키움:{(kiwoomOk ? "OK" : "X")} Cybos:{(cybosOk ? "OK" : "X")}");
            }
            catch (Exception ex)
            {
                AppendLog($"연결 실패: {ex.Message}");
                _lblStatus.Text = "연결 실패";
                _btnConnect.Enabled = true;
                _btnConnect.Text = "연결";
            }
        }

        private void Disconnect()
        {
            _conn?.Disconnect();
            AppendLog("연결 해제됨");
        }

        // ═══════════════════════════════════════════
        //  파이프 Push 메시지 라우팅
        // ═══════════════════════════════════════════
        private void OnPushReceived(ushort msgType, uint seqNo, byte[] body)
        {
            _msgCount++;

            // MarketDataService가 RealtimePush(0x0022)를 자체 처리하므로
            // 여기서는 그 외 Push만 처리

            switch (msgType)
            {
                case MessageTypes.TradePush:
                    HandleTradePush(body);
                    break;

                case MessageTypes.BalancePush:
                    HandleBalancePush(body);
                    break;

                case MessageTypes.ConditionResult:
                    HandleConditionResult(body);
                    break;

                case MessageTypes.ConditionRealtime:
                    HandleConditionRealtime(body);
                    break;

                case MessageTypes.OrderTestResponse:
                    string log = Encoding.UTF8.GetString(body);
                    AppendLog(log);
                    break;
            }
        }

        private void HandleTradePush(byte[] body)
        {
            try
            {
                var trade = BinarySerializer.DeserializeTrade(body);
                AppendLog($"[체결] {trade}");
                // Phase 4: OrderManager.ProcessFill(trade) 호출 예정
            }
            catch (Exception ex)
            {
                AppendLog($"[체결 파싱 오류] {ex.Message}");
            }
        }

        private void HandleBalancePush(byte[] body)
        {
            try
            {
                var balance = BinarySerializer.DeserializeBalance(body);
                AppendLog($"[잔고] {balance}");
                // Phase 4: BalanceManager.Update(balance) 호출 예정
                this.BeginInvoke((Action)(() =>
                {
                    _portfolioForm?.UpdatePosition(balance);
                }));
            }
            catch (Exception ex)
            {
                AppendLog($"[잔고 파싱 오류] {ex.Message}");
            }
        }

        private void HandleConditionResult(byte[] body)
        {
            try
            {
                string payload = Encoding.UTF8.GetString(body);
                AppendLog($"[조건검색 결과] 수신 {payload.Length}자");
                this.BeginInvoke((Action)(() =>
                {
                    _watchForm?.OnConditionResult(payload);
                }));
            }
            catch (Exception ex)
            {
                AppendLog($"[조건검색 오류] {ex.Message}");
            }
        }

        private void HandleConditionRealtime(byte[] body)
        {
            try
            {
                string payload = Encoding.UTF8.GetString(body);
                AppendLog($"[실시간 조건] {payload}");
                // Phase 3: StockManager.AddFromConditionRealtime() 호출 예정
            }
            catch (Exception ex)
            {
                AppendLog($"[실시간 조건 오류] {ex.Message}");
            }
        }

        // ═══════════════════════════════════════════
        //  주문 극한테스트 (기존 기능 유지)
        // ═══════════════════════════════════════════
        private async void BtnOrderTest_Click(object sender, EventArgs e)
        {
            _btnOrderTest.Enabled = false;
            _btnOrderTest.Text = "테스트 실행중...";
            AppendLog("═══════ 주문 극한테스트 요청 → Server32 ═══════");

            try
            {
                var resp = await _conn.RequestAsync(
                    MessageTypes.OrderTestRequest, null, 120000);

                if (resp.respType == MessageTypes.OrderTestResponse)
                {
                    string result = Encoding.UTF8.GetString(resp.respBody);
                    AppendLog(result);
                    AppendLog("═══════ 주문 극한테스트 완료 ═══════");
                }
                else if (resp.respType == MessageTypes.ErrorResponse)
                {
                    string err = Encoding.UTF8.GetString(resp.respBody);
                    AppendLog("[ERR] " + err);
                }
            }
            catch (OperationCanceledException)
            {
                AppendLog("[TIMEOUT] 주문테스트 응답 타임아웃 (120초 초과)");
            }
            catch (Exception ex)
            {
                AppendLog("[ERR] 주문테스트 실패: " + ex.Message);
            }
            finally
            {
                _btnOrderTest.Enabled = _conn?.IsConnected ?? false;
                _btnOrderTest.Text = "주문 극한테스트";
            }
        }

        // ═══════════════════════════════════════════
        //  상태 표시
        // ═══════════════════════════════════════════
        private void OnConnectionChanged(bool connected)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<bool>(OnConnectionChanged), connected);
                return;
            }

            _lblConnState.Text = connected ? "● 연결됨" : "● 끊김";
            _lblConnState.ForeColor = connected ? Color.FromArgb(80, 250, 120) : Color.Red;

            if (!connected)
            {
                _lblStatus.Text = "연결 끊김";
                _btnConnect.Enabled = true;
                _btnConnect.Text = "연결";
                _btnOrderTest.Enabled = false;
                AppendLog("Server32 연결이 끊어졌습니다");
            }
        }

        private void UpdateKiwoomIndicator(bool ok)
        {
            _lblKiwoomState.Text = ok ? "K:OK" : "K:X";
            _lblKiwoomState.ForeColor = ok ? Color.FromArgb(80, 250, 120) : Color.Gray;
        }

        private void UpdateCybosIndicator(bool ok)
        {
            _lblCybosState.Text = ok ? "C:OK" : "C:X";
            _lblCybosState.ForeColor = ok ? Color.FromArgb(80, 200, 255) : Color.Gray;
        }

        // ═══════════════════════════════════════════
        //  차트 폼 (멀티 인스턴스 – Document 영역)
        // ═══════════════════════════════════════════
        public void ShowChart(string stockCode, string stockName)
        {
            foreach (var content in _dockPanel.Documents)
            {
                if (content is ChartForm existing && existing.StockCode == stockCode)
                {
                    existing.Activate();
                    return;
                }
            }

            var chart = new ChartForm(stockCode, stockName);
            chart.Show(_dockPanel, DockState.Document);
        }

        // ═══════════════════════════════════════════
        //  실시간 구독 (WatchForm에서 호출)
        // ═══════════════════════════════════════════
        public async Task SubscribeRealtimeAsync(string code)
        {
            if (_market == null) return;
            try
            {
                await _market.SubscribeAsync(code);
                AppendLog($"실시간 등록: {code}");
            }
            catch (Exception ex)
            {
                AppendLog($"실시간 등록 실패: {ex.Message}");
            }
        }

        // ═══════════════════════════════════════════
        //  공개 서비스 접근자 (자식 폼용)
        // ═══════════════════════════════════════════
        public ConnectionService Connection => _conn;
        public CandleService Candles => _candle;
        public OrderService Orders => _order;

        // ═══════════════════════════════════════════
        //  로그
        // ═══════════════════════════════════════════
        public void AppendLog(string msg)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<string>(AppendLog), msg);
                return;
            }
            var timestamped = $"[{DateTime.Now:HH:mm:ss.fff}] {msg}";
            _logForm?.AppendLog(timestamped);
        }

        // ═══════════════════════════════════════════
        //  헬퍼: 싱글톤 DockContent 표시/활성화
        // ═══════════════════════════════════════════
        private void ShowOrActivate<T>(ref T form) where T : DockContent, new()
        {
            if (form == null || form.IsDisposed)
            {
                form = CreateForm<T>();
                form.Show(_dockPanel, GetDefaultDockState<T>());
            }
            else
            {
                form.Activate();
            }
        }

        private T CreateForm<T>() where T : DockContent, new()
        {
            if (typeof(T) == typeof(WatchForm))
                return (T)(DockContent)new WatchForm(this);
            return new T();
        }

        private DockState GetDefaultDockState<T>()
        {
            if (typeof(T) == typeof(LogForm)) return DockState.DockBottom;
            if (typeof(T) == typeof(SettingsForm)) return DockState.DockRight;
            if (typeof(T) == typeof(WatchForm)) return DockState.DockLeft;
            if (typeof(T) == typeof(PortfolioForm)) return DockState.DockBottom;
            return DockState.Document;
        }

        // ═══════════════════════════════════════════
        //  정리
        // ═══════════════════════════════════════════
        protected override void OnFormClosing(FormClosingEventArgs e)
        {
            _clockTimer?.Stop();
            _conn?.Disconnect();
            _conn?.Dispose();
            base.OnFormClosing(e);
        }
    }

    // ═══════════════════════════════════════════════
    //  다크 테마 렌더러
    // ═══════════════════════════════════════════════
    internal class DarkToolStripRenderer : ToolStripProfessionalRenderer
    {
        protected override void OnRenderToolStripBackground(ToolStripRenderEventArgs e)
        {
            using (var brush = new SolidBrush(Color.FromArgb(30, 30, 40)))
                e.Graphics.FillRectangle(brush, e.AffectedBounds);
        }

        protected override void OnRenderSeparator(ToolStripSeparatorRenderEventArgs e)
        {
            int y = e.Item.Height / 2;
            using (var pen = new Pen(Color.FromArgb(70, 70, 70)))
                e.Graphics.DrawLine(pen, 4, y, e.Item.Width - 4, y);
        }
    }
}
Copy
5. Forms/LogForm.cs
Copyusing System;
using System.Drawing;
using System.Windows.Forms;
using WeifenLuo.WinFormsUI.Docking;

namespace App64.Forms
{
    public class LogForm : DockContent
    {
        private readonly RichTextBox _txtLog;
        private const int MAX_LINES = 5000;

        public LogForm()
        {
            this.Text = "로그";
            this.DockAreas = DockAreas.DockBottom | DockAreas.DockTop | DockAreas.Float;
            this.ShowHint = DockState.DockBottom;
            this.CloseButton = false;
            this.CloseButtonVisible = false;

            _txtLog = new RichTextBox
            {
                Dock = DockStyle.Fill,
                ReadOnly = true,
                BackColor = Color.FromArgb(20, 20, 30),
                ForeColor = Color.FromArgb(160, 230, 160),
                Font = new Font("Consolas", 9f),
                BorderStyle = BorderStyle.None,
                WordWrap = false
            };
            this.Controls.Add(_txtLog);
        }

        public void AppendLog(string message)
        {
            if (_txtLog == null || _txtLog.IsDisposed) return;
            if (_txtLog.InvokeRequired)
            {
                _txtLog.BeginInvoke(new Action<string>(AppendLog), message);
                return;
            }

            // 라인 수 제한
            if (_txtLog.Lines.Length > MAX_LINES)
            {
                _txtLog.SelectionStart = 0;
                _txtLog.SelectionLength = _txtLog.GetFirstCharIndexFromLine(MAX_LINES / 2);
                _txtLog.SelectedText = "";
            }

            // 색상 분류
            Color color = Color.FromArgb(160, 230, 160); // 기본 녹색
            if (message.Contains("[오류]") || message.Contains("[ERR]"))
                color = Color.OrangeRed;
            else if (message.Contains("연결") || message.Contains("로그인"))
                color = Color.FromArgb(80, 250, 120);
            else if (message.Contains("[조건검색]") || message.Contains("[실시간 조건]"))
                color = Color.Cyan;
            else if (message.Contains("[체결]") || message.Contains("[주문]"))
                color = Color.Yellow;
            else if (message.Contains("[잔고]"))
                color = Color.FromArgb(255, 180, 100);

            _txtLog.SelectionStart = _txtLog.TextLength;
            _txtLog.SelectionLength = 0;
            _txtLog.SelectionColor = color;
            _txtLog.AppendText(message + Environment.NewLine);
            _txtLog.ScrollToCaret();
        }

        public void Clear() => _txtLog?.Clear();
    }
}
Copy
6. Forms/WatchForm.cs
Copyusing System;
using System.Collections.Generic;
using System.Drawing;
using System.Windows.Forms;
using Common.Models;
using WeifenLuo.WinFormsUI.Docking;

namespace App64.Forms
{
    public class WatchForm : DockContent
    {
        private readonly MainForm _mainForm;
        private readonly DataGridView _grid;
        private readonly Dictionary<string, int> _stockRowMap = new Dictionary<string, int>();

        public WatchForm() : this(null) { }

        public WatchForm(MainForm mainForm)
        {
            _mainForm = mainForm;

            this.Text = "종목감시";
            this.DockAreas = DockAreas.DockLeft | DockAreas.DockRight
                           | DockAreas.Float | DockAreas.Document;
            this.ShowHint = DockState.DockLeft;

            _grid = new DataGridView
            {
                Dock = DockStyle.Fill,
                ReadOnly = true,
                AllowUserToAddRows = false,
                AllowUserToDeleteRows = false,
                AllowUserToResizeRows = false,
                SelectionMode = DataGridViewSelectionMode.FullRowSelect,
                MultiSelect = false,
                BackgroundColor = Color.FromArgb(25, 25, 35),
                ForeColor = Color.FromArgb(200, 220, 200),
                GridColor = Color.FromArgb(50, 50, 50),
                DefaultCellStyle = new DataGridViewCellStyle
                {
                    BackColor = Color.FromArgb(25, 25, 35),
                    ForeColor = Color.FromArgb(200, 220, 200),
                    SelectionBackColor = Color.FromArgb(50, 80, 120),
                    Font = new Font("Consolas", 9f)
                },
                ColumnHeadersDefaultCellStyle = new DataGridViewCellStyle
                {
                    BackColor = Color.FromArgb(40, 40, 50),
                    ForeColor = Color.White,
                    Font = new Font("맑은 고딕", 9f, FontStyle.Bold)
                },
                EnableHeadersVisualStyles = false,
                RowHeadersVisible = false,
                BorderStyle = BorderStyle.None,
                AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill
            };

            _grid.Columns.AddRange(new DataGridViewColumn[]
            {
                Col("Code",     "코드",     70,  8),
                Col("Name",     "종목명",   100, 14),
                Col("Price",    "현재가",   80,  10),
                Col("Change",   "등락%",    60,  8),
                Col("Volume",   "거래량",   80,  10),
                Col("OpenDiff", "시가대비", 70,  8),
                Col("TickCnt",  "체결건수", 80,  9),
                Col("TickRat",  "틱비율",   70,  8),
                Col("VIPrice",  "VI가격",   80,  9),
                Col("VIDist",   "VI%",      60,  8),
                Col("Signal",   "신호",     50,  8),
            });

            _grid.CellDoubleClick += Grid_CellDoubleClick;
            this.Controls.Add(_grid);
        }

        private static DataGridViewTextBoxColumn Col(
            string name, string header, int width, int fillWeight)
        {
            return new DataGridViewTextBoxColumn
            {
                Name = name,
                HeaderText = header,
                Width = width,
                FillWeight = fillWeight
            };
        }

        // ── 더블클릭 → 차트 열기 ──
        private void Grid_CellDoubleClick(object sender, DataGridViewCellEventArgs e)
        {
            if (e.RowIndex < 0) return;
            var code = _grid.Rows[e.RowIndex].Cells["Code"].Value?.ToString();
            var name = _grid.Rows[e.RowIndex].Cells["Name"].Value?.ToString();
            if (!string.IsNullOrEmpty(code))
                _mainForm?.ShowChart(code, name ?? code);
        }

        // ── 조건검색 결과 수신 ──
        public void OnConditionResult(string payload)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<string>(OnConditionResult), payload);
                return;
            }

            _grid.Rows.Clear();
            _stockRowMap.Clear();

            // 예상 형식: "코드1|종목명1|현재가1;코드2|종목명2|현재가2;..."
            var items = payload.Split(new[] { ';' }, StringSplitOptions.RemoveEmptyEntries);
            foreach (var item in items)
            {
                var fields = item.Split('|');
                if (fields.Length < 2) continue;

                int rowIdx = _grid.Rows.Add();
                _grid.Rows[rowIdx].Cells["Code"].Value = fields[0];
                _grid.Rows[rowIdx].Cells["Name"].Value = fields.Length > 1 ? fields[1] : "";
                _grid.Rows[rowIdx].Cells["Price"].Value = fields.Length > 2 ? fields[2] : "";

                _stockRowMap[fields[0]] = rowIdx;

                // 실시간 등록
                _ = _mainForm?.SubscribeRealtimeAsync(fields[0]);
            }
        }

        // ── MarketData 실시간 업데이트 ──
        public void UpdateMarketData(MarketData md)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<MarketData>(UpdateMarketData), md);
                return;
            }

            if (!_stockRowMap.TryGetValue(md.Code, out int rowIdx)) return;
            if (rowIdx >= _grid.Rows.Count) return;

            var row = _grid.Rows[rowIdx];
            row.Cells["Price"].Value = md.Price.ToString("N0");

            double changeRate = md.ChangeRate;
            string sign = changeRate >= 0 ? "+" : "";
            row.Cells["Change"].Value = sign + changeRate.ToString("F2") + "%";
            row.Cells["Change"].Style.ForeColor =
                changeRate > 0 ? Color.Red :
                changeRate < 0 ? Color.RoyalBlue : Color.White;

            row.Cells["Volume"].Value = md.AccVolume.ToString("N0");

            // 시가 대비
            if (md.Open > 0)
            {
                double openDiff = (double)(md.Price - md.Open) / md.Open * 100.0;
                row.Cells["OpenDiff"].Value = openDiff.ToString("+0.00;-0.00;0.00") + "%";
                row.Cells["OpenDiff"].Style.ForeColor =
                    openDiff > 0 ? Color.Red :
                    openDiff < 0 ? Color.RoyalBlue : Color.White;
            }
        }

        // ── 기존 OnTickData 호환 (deprecated – Phase 3에서 제거) ──
        public void OnTickData(string payload)
        {
            // MarketDataService.OnMarketDataUpdated → UpdateMarketData로 대체됨
        }

        public void ClearAll()
        {
            _grid.Rows.Clear();
            _stockRowMap.Clear();
        }
    }
}
Copy
7. Forms/ChartForm.cs
Copyusing System.Drawing;
using System.Windows.Forms;
using WeifenLuo.WinFormsUI.Docking;

namespace App64.Forms
{
    public class ChartForm : DockContent
    {
        public string StockCode { get; }
        public string StockName { get; }

        private readonly Panel _chartPanel;

        public ChartForm(string stockCode, string stockName)
        {
            StockCode = stockCode;
            StockName = stockName;

            this.Text = $"{stockName} ({stockCode})";
            this.DockAreas = DockAreas.Document | DockAreas.Float;
            this.ShowHint = DockState.Document;

            _chartPanel = new Panel
            {
                Dock = DockStyle.Fill,
                BackColor = Color.FromArgb(20, 20, 30)
            };

            var lbl = new Label
            {
                Text = $"차트 영역\n{stockName} ({stockCode})\n\n"
                     + "Phase 6에서 캔들 차트 + 지표 렌더링 구현 예정\n"
                     + "(C++ IndicatorEngine DLL 연동)",
                Dock = DockStyle.Fill,
                ForeColor = Color.Gray,
                Font = new Font("맑은 고딕", 14f),
                TextAlign = ContentAlignment.MiddleCenter
            };

            _chartPanel.Controls.Add(lbl);
            this.Controls.Add(_chartPanel);
        }
    }
}
Copy
8. Forms/SettingsForm.cs
Copyusing System.Drawing;
using System.Windows.Forms;
using WeifenLuo.WinFormsUI.Docking;

namespace App64.Forms
{
    public class SettingsForm : DockContent
    {
        public SettingsForm()
        {
            this.Text = "설정";
            this.DockAreas = DockAreas.DockRight | DockAreas.DockLeft | DockAreas.Float;
            this.ShowHint = DockState.DockRight;

            var lbl = new Label
            {
                Text = "전략 파라미터 설정\n\n"
                     + "Phase 7에서 구현 예정:\n"
                     + "- Strategy-0 파라미터 (시가대비%, 틱비율, VI거리%)\n"
                     + "- 손절/익절 비율\n"
                     + "- 자동매매 ON/OFF\n"
                     + "- 데이터 기록 경로",
                Dock = DockStyle.Fill,
                ForeColor = Color.Gray,
                BackColor = Color.FromArgb(25, 25, 35),
                Font = new Font("맑은 고딕", 11f),
                TextAlign = ContentAlignment.MiddleCenter
            };
            this.Controls.Add(lbl);
        }
    }
}
Copy
9. Forms/PortfolioForm.cs
Copyusing System;
using System.Drawing;
using System.Windows.Forms;
using Common.Models;
using WeifenLuo.WinFormsUI.Docking;

namespace App64.Forms
{
    public class PortfolioForm : DockContent
    {
        private readonly DataGridView _gridPositions;
        private readonly Label _lblSummary;

        public PortfolioForm()
        {
            this.Text = "포트폴리오";
            this.DockAreas = DockAreas.DockBottom | DockAreas.DockTop
                           | DockAreas.Float | DockAreas.Document;
            this.ShowHint = DockState.DockBottom;
            this.CloseButton = false;
            this.CloseButtonVisible = false;

            _lblSummary = new Label
            {
                Dock = DockStyle.Top,
                Height = 30,
                BackColor = Color.FromArgb(35, 35, 45),
                ForeColor = Color.White,
                Font = new Font("맑은 고딕", 10f),
                TextAlign = ContentAlignment.MiddleLeft,
                Text = "  총자산: -- | 실현손익: -- | 미체결: --",
                Padding = new Padding(5, 0, 0, 0)
            };

            _gridPositions = new DataGridView
            {
                Dock = DockStyle.Fill,
                ReadOnly = true,
                AllowUserToAddRows = false,
                BackgroundColor = Color.FromArgb(25, 25, 35),
                ForeColor = Color.White,
                GridColor = Color.FromArgb(50, 50, 50),
                EnableHeadersVisualStyles = false,
                RowHeadersVisible = false,
                BorderStyle = BorderStyle.None,
                ColumnHeadersDefaultCellStyle = new DataGridViewCellStyle
                {
                    BackColor = Color.FromArgb(40, 40, 50),
                    ForeColor = Color.White,
                    Font = new Font("맑은 고딕", 9f, FontStyle.Bold)
                },
                DefaultCellStyle = new DataGridViewCellStyle
                {
                    BackColor = Color.FromArgb(25, 25, 35),
                    ForeColor = Color.White,
                    Font = new Font("Consolas", 9f)
                }
            };

            _gridPositions.Columns.AddRange(new DataGridViewColumn[]
            {
                new DataGridViewTextBoxColumn { Name = "Code",     HeaderText = "코드",   Width = 70 },
                new DataGridViewTextBoxColumn { Name = "Name",     HeaderText = "종목명", Width = 100 },
                new DataGridViewTextBoxColumn { Name = "Qty",      HeaderText = "수량",   Width = 60 },
                new DataGridViewTextBoxColumn { Name = "AvgPrice", HeaderText = "평균가", Width = 80 },
                new DataGridViewTextBoxColumn { Name = "CurPrice", HeaderText = "현재가", Width = 80 },
                new DataGridViewTextBoxColumn { Name = "PnL",      HeaderText = "손익",   Width = 80 },
                new DataGridViewTextBoxColumn { Name = "PnLRate",  HeaderText = "수익률", Width = 70 },
            });

            this.Controls.Add(_gridPositions);
            this.Controls.Add(_lblSummary);
        }

        public void UpdateSummary(string totalAsset, string realizedPnL, string pendingCount)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<string, string, string>(UpdateSummary),
                    totalAsset, realizedPnL, pendingCount);
                return;
            }
            _lblSummary.Text = $"  총자산: {totalAsset} | 실현손익: {realizedPnL} | 미체결: {pendingCount}";
        }

        public void UpdatePosition(BalanceInfo balance)
        {
            if (InvokeRequired)
            {
                BeginInvoke(new Action<BalanceInfo>(UpdatePosition), balance);
                return;
            }

            // 기존 행 찾기 또는 추가
            DataGridViewRow targetRow = null;
            foreach (DataGridViewRow row in _gridPositions.Rows)
            {
                if (row.Cells["Code"].Value?.ToString() == balance.Code)
                {
                    targetRow = row;
                    break;
                }
            }

            if (targetRow == null)
            {
                if (balance.Qty <= 0) return; // 수량 0이면 추가 불필요
                int idx = _gridPositions.Rows.Add();
                targetRow = _gridPositions.Rows[idx];
            }

            if (balance.Qty <= 0)
            {
                // 수량 0이면 행 제거
                _gridPositions.Rows.Remove(targetRow);
                return;
            }

            targetRow.Cells["Code"].Value = balance.Code;
            targetRow.Cells["Name"].Value = balance.Name;
            targetRow.Cells["Qty"].Value = balance.Qty.ToString("N0");
            targetRow.Cells["AvgPrice"].Value = balance.AvgPrice.ToString("N0");
            targetRow.Cells["CurPrice"].Value = balance.CurrentPrice.ToString("N0");
            targetRow.Cells["PnL"].Value = balance.ProfitLoss.ToString("N0");
            targetRow.Cells["PnLRate"].Value = balance.ProfitRate.ToString("F2") + "%";

            // 색상
            Color plColor = balance.ProfitLoss > 0 ? Color.Red :
                            balance.ProfitLoss < 0 ? Color.RoyalBlue : Color.White;
            targetRow.Cells["PnL"].Style.ForeColor = plColor;
            targetRow.Cells["PnLRate"].Style.ForeColor = plColor;
        }
    }
}
Copy
빌드 절차
1. NuGet 패키지 설치:
   Visual Studio → 패키지 관리자 콘솔:
   > Install-Package DockPanelSuite -Version 3.1.0 -ProjectName App64
   > Install-Package DockPanelSuite.ThemeVS2015 -Version 3.1.0 -ProjectName App64

   또는 수동으로 packages.config + csproj 참조 추가

2. App64/ 폴더에 Forms/ 디렉토리 생성

3. 위 파일들을 해당 경로에 배치

4. 빌드 (Ctrl+Shift+B)
변경 영향 분석
기존 기능	Phase 1 이후
파이프 연결/로그인	동일 (ConnectionService 미변경)
실시간 시세 수신	MarketDataService → WatchForm.UpdateMarketData()로 연결
주문 극한테스트	동일 (btnOrderTest 유지)
조건검색 결과	Push → WatchForm.OnConditionResult()로 연결
체결/잔고 Push	로그 + PortfolioForm.UpdatePosition()으로 연결
차트	더블클릭 → ChartForm 생성 (렌더링은 Phase 6)
기존 Services 4개 파일은 1바이트도 수정하지 않습니다. Bridge, Common, Server32도 변경 없습니다. 순수하게 App64의 MainForm UI 레이어만 교체합니다.

빌드 후 NuGet 경로 관련 오류가 나면 알려주세요. 실제 DockPanelSuite 3.1.0의 정확한 lib 경로를 확인해드리겠습니다.